name: AI Agent Tests
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Run AI Agent Tests
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          # Install cagent directly
          curl -L -o cagent https://github.com/docker/cagent/releases/latest/download/cagent-linux-amd64
          chmod +x cagent
          
          # Run cagent with proper flags and redirect output
          ./cagent run container-nerdy-central.yaml \
            "Run all tests and report results" \
            --debug > test-report.txt 2>&1
      
      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results
          path: test-report.txt